<!DOCTYPE html><html lang="en"><head><meta name="generator" content="React Static"/><title data-react-helmet="true">Building a commentary sidebar in React - tuzz.tech</title><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, shrink-to-fit=no"/><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1.0"/><meta data-react-helmet="true" name="author" content="Chris Patuzzo"/><meta data-react-helmet="true" property="og:title" content="Building a commentary sidebar in React"/><meta data-react-helmet="true" property="og:url" content="https://tuzz.tech/blog/react-commentary-sidebar"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:description" content="How I built one of my favourite features: a commentary sidebar, written in React."/><meta data-react-helmet="true" name="description" content="How I built one of my favourite features: a commentary sidebar, written in React."/><meta data-react-helmet="true" name="keywords" content="Chris Patuzzo,React,commentary,sidebar,aside,hooks,CSS,positioning"/><meta data-react-helmet="true" property="og:image" content="https://tuzz.tech/images/commentary-sidebar.gif"/><meta data-react-helmet="true" property="og:image:secure_url" content="https://tuzz.tech/images/commentary-sidebar.gif"/><meta data-react-helmet="true" property="og:image:width" content="600"/><meta data-react-helmet="true" property="og:image:height" content="478"/><meta data-react-helmet="true" property="og:video" content="https://tuzz.tech/videos/commentary-sidebar.mp4"/><meta data-react-helmet="true" property="og:video:secure_url" content="https://tuzz.tech/videos/commentary-sidebar.mp4"/><meta data-react-helmet="true" property="og:image:type" content="video/mp4"/><meta data-react-helmet="true" property="og:video:width" content="1120"/><meta data-react-helmet="true" property="og:video:height" content="892"/><link rel="preload" as="script" href="/templates/__react_static_root__/app/pages/blog/adding-bash-completion.mdx~__react_static_root__/app/pages/blog~1caefab3.c0ff43d2.js"/><link rel="preload" as="script" href="/templates/__react_static_root__/app/pages/blog/react-commentary-sidebar.mdx.8a5c992c.js"/><link rel="preload" as="script" href="/templates/styles.f5f0f4b2.js"/><link rel="preload" as="script" href="/templates/vendors~main.abecbdad.js"/><link rel="preload" as="script" href="/main.4c9105b0.js"/><link rel="preload" as="style" href="/main.6c84323b.css"/><link rel="stylesheet" href="/main.6c84323b.css"/><link rel="preload" as="style" href="/styles.c538bfc6.css"/><link rel="stylesheet" href="/styles.c538bfc6.css"/><link rel="preload" as="style" href="/__react_static_root__/app/pages/blog/adding-bash-completion.mdx~__react_static_root__/app/pages/blog~1caefab3.0295268c.css"/><link rel="stylesheet" href="/__react_static_root__/app/pages/blog/adding-bash-completion.mdx~__react_static_root__/app/pages/blog~1caefab3.0295268c.css"/><link rel="preload" as="style" href="/__react_static_root__/app/pages/blog/react-commentary-sidebar.mdx.61dc9c69.css"/><link rel="stylesheet" href="/__react_static_root__/app/pages/blog/react-commentary-sidebar.mdx.61dc9c69.css"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css?family=Merriweather:400,400i|Source+Code+Pro:500,500i&amp;display=swap" rel="stylesheet"/><link data-react-helmet="true" rel="alternate" type="application/rss+xml" title="tuzz.tech" href="/feed.xml"/><link data-react-helmet="true" rel="icon" href="data:;base64,iVBORw0KGgo="/><link data-react-helmet="true" rel="prev" href="/blog/palindromic-superpermutations"/><link data-react-helmet="true" rel="next" href="/blog/react-commentary-sidebar-2"/></head><body><div id="root"><div style="outline:none" tabindex="-1"><div class="styles-layout_qpgG"><div class="styles-content_1JPb"><div style="outline:none" tabindex="-1"><div style="outline:none" tabindex="-1"><div class="styles-nav_bar_2D66"><span class="styles-breadcrumbs_2-AT"><a href="/blog/pair-programming-in-sentient">tuzz.tech</a><a href="/blog/pair-programming-in-sentient">blog</a></span><span class="styles-links_nqg2"><a href="/blog/palindromic-superpermutations">← Previous</a><a href="/blog/react-commentary-sidebar-2">Next Article →</a></span></div><h1 class="styles-h1_3RZl">Building a commentary sidebar in React</h1><time dateTime="2019-10-30T12:00Z">Published <!-- -->October 30, 2019<!-- --> by <!-- --> <a href="https://twitter.com/chrispatuzzo" target="_blank">Chris Patuzzo</a><a href="/feed.xml" target="_blank" class="styles-feed_icon_SE8y"><svg width="16" height="16" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><circle cx="3.429" cy="20.571" r="3.429"></circle><path d="m11.429 24h4.57c0-8.821-7.178-15.999-15.999-16v4.572c6.302.001 11.429 5.126 11.429 11.428z"></path><path d="m24 24c0-13.234-10.766-24-24-24v4.571c10.714 0 19.43 8.714 19.43 19.429z"></path></svg></a></time><div class="note">This is the first of two parts. Part two is <a href="/blog/react-commentary-sidebar-2">here</a>.</div><span></span><span></span><figure class="more_space styles-figure_23Vi"><a href="/videos/commentary-sidebar.mp4" target="_blank"><video muted="" autoplay="" playsinline="" loop=""><source src="/videos/commentary-sidebar.mp4" type="video/mp4"/></video></a><figcaption><span class="styles-arrow_2C7-">▲</span><span>The sidebar is responsive and collapses inline on smaller screens</span></figcaption></figure><aside class="styles-aside_161L"><p>This is taken from my recent article on <a href="/blog/how-bash-completion-works">How bash completion
works</a>.</p></aside><aside class="styles-aside_161L"><p>I’m going to break the fourth wall a lot in this article. Uh oh...</p></aside><p>Over the past weeks, I’ve been building this blog and writing articles for it.
I’ve spent a lot of time thinking about the reader. Who are they? Why are they
here? It’s often hard to know how much detail to go into and how much background
knowledge to assume.</p><p>On the one hand, people are busy. Attentions are short and time is precious. I’d
do well to keep articles lean, focussed and to the point. But that <em>misses</em> the
point. People are here for enjoyment and just presenting the cold hard facts
isn’t going to cut it.</p><p>I’ve settled on an approach I hope will cater to a variety of readers. I keep
the main body of content concise and <em>on topic</em> but enrich it with commentary on
the side. This leaves room for elaboration, tangential remarks and all the
whimsy I can <span>mustard</span>.</p><aside class="styles-aside_161L"><p>I’m so sorry.</p></aside><p>However, this commentary hides complexity. When <span>viewed</span> on a large-enough screen, it’s presented in a
sidebar next to the main content. Ideally, comments sit as close as possible to
the word or phrase they refer to. This helps flow and improves continuity.</p><aside class="styles-aside_161L"><p>When viewed on mobile, comments are presented inside the main content but with softer styles to show they’re supplementary.</p></aside><p>In this article, I’ll explain the mechanics of how this works in my React app.
As you’ll see, there’s a lot to consider to make a robust, responsive and
semantic <span>solution</span>.</p><aside class="styles-aside_161L"><p>... that’s SEO and print friendly.</p></aside><a href="#structuring-the-dom"><h2 id="structuring-the-dom" class="styles-h2_13mz">Structuring the DOM</h2></a><p>Putting React to one side for a moment, let’s first consider how to structure
the DOM.  HTML5 has the perfect element for our needs:</p><blockquote><p>The HTML <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> element represents a portion of a document whose content is
only indirectly related to the document’s main content. Asides are frequently
presented as sidebars or call-out boxes.
<!-- --> <em>– <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/aside" target="_blank">MDN web docs</a></em></p></blockquote><p>That leaves the question of whether to group all commentary together into <span>a</span> single <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> or to have one per comment. I
decided on the latter as I think this is more meaningful. Comments are
independent of each other so the DOM should reflect that.</p><aside class="styles-aside_161L"><p>It’s also easier to intersperse comments with content using this approach which is useful for mobile.</p></aside><p>Here’s how that looks in code:</p><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-html"><code class="prism-code language-html"><span class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">main</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">article</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain">The article&#x27;s first paragraph.</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">aside</span><span class="token tag punctuation">&gt;</span><span class="token plain">A comment on the above.</span><span class="token tag punctuation">&lt;/</span><span class="token tag">aside</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain">The article&#x27;s second paragraph.</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">article</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">main</span><span class="token tag punctuation">&gt;</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>Comments interspersed with content</p></span></figcaption></figure><p>This <em>should</em> be friendlier to search engines, too. Related content is closer
together.</p><a href="#laying-things-out"><h3 id="laying-things-out" class="styles-h3_yb8_">Laying things out</h3></a><p>As you can see above, there’s no DOM element for the sidebar. I think of a
sidebar as a way to present <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> elements. It really ought to be a
presentational concern.</p><p>There are a number of CSS techniques we could use to create a sidebar. There’s
flexbox, floats, relative and absolute positioning. This seemed simplest to
me:</p><span></span><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-css"><code class="prism-code language-css"><span class="token-line"><span class="token selector">main</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token property">max-width</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">50</span><span class="token unit">%</span><span class="token punctuation">;</span><span class="token plain">         // Article width</span></span><span class="token-line"><span class="token plain">  </span><span class="token property">padding-right</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">50</span><span class="token unit">%</span><span class="token punctuation">;</span><span class="token plain">     // Sidebar width</span></span><span class="token-line"><span class="token plain">  </span><span class="token property">background</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token hexcode">#eee</span><span class="token punctuation">;</span><span class="token plain">       // Sidebar color</span></span><span class="token-line"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation">:</span><span class="token plain"> relative</span><span class="token selector">;</span></span><span class="token-line"><span class="token selector"></span></span><span class="token-line"><span class="token selector">  article</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token property">padding</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token unit">rem</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token property">background</span><span class="token punctuation">:</span><span class="token plain"> white</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token selector">aside</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token property">position</span><span class="token punctuation">:</span><span class="token plain"> absolute</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token property">right</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">1</span><span class="token unit">rem</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token property">width</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">calc</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token unit">%</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> </span><span class="token number">2</span><span class="token unit">rem</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>One way of creating a sidebar with <span>CSS</span></p></span></figcaption></figure><aside class="styles-aside_161L"><p>  Technically it’s <a href="https://sass-lang.com/" target="_blank">Sass</a> as it uses nested rules.</p></aside><aside class="styles-aside_161L"><p>I’ve simplified this a bit. I also have rules to set colors, borders, etc - and some media queries to change the presentation for smaller screens.</p></aside><p>This works by splitting the container in two. The sidebar comments live in the
space created by the <code class="prism-code language-none"><span class="token-line"><span class="token plain">padding-right</span></span></code> rule. They use absolute positioning which
removes them from the document’s flow and <code class="prism-code language-none"><span class="token-line"><span class="token plain">right: 1rem</span></span></code> to place them in the
padded region.</p><p>We can left-position the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> elements within the sidebar by setting their
width. This is calculated as <code class="prism-code language-none"><span class="token-line"><span class="token plain">50% - 2rem</span></span></code> to create the illusion of
padding - by leaving an equal amount of space on the left and right. Here’s how
it looks:</p><span></span><figure class="undefined styles-figure_23Vi"><div class="styles-frame_2QDX"><iframe style="height:0px;transform:scale(1)" scrolling="no"></iframe><div class="styles-loading_2WpJ"></div></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>Using padding to create a sidebar on the right</p></span></figcaption></figure><aside class="styles-aside_161L"><p>This is a live version of the code running in a frame. You can see a standalone version <a target="_blank" href="/examples/sidebar-1/example.html">here</a>.</p></aside><p>This isn’t quite right because the comment is placed next to the second
paragraph instead of the first. We could fix it by moving the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> above
the first paragraph but then the DOM would be out of order and wouldn’t read
correctly on mobile.</p><a href="#further-complications"><h3 id="further-complications" class="styles-h3_yb8_">Further complications</h3></a><p>To make matters worse, we also want to be able to position commentary next to
specific words or phrases. For example:</p><figure class="undefined styles-figure_23Vi"><div class="styles-frame_2QDX"><iframe style="height:0px;transform:scale(1)" scrolling="no"></iframe><div class="styles-loading_2WpJ"></div></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>A <span>badly-placed</span> comment that<span style="position:relative;top:2px;left:4px">doesn’t line up</span></p></span></figcaption></figure><aside class="styles-aside_161L"><p>Yes, red definitely c<span style="color:#663922">l</span><span style="color:#773933">a</span><span style="color:#883944">s</span><span style="color:#993955">h</span><span style="color:#aa3955">e</span><span style="color:#bb3955">s</span>.</p></aside><p>We can use absolute positioning for this but it’s not so straightforward. The
paragraph is free-flowing text which means it’s hard to predict where the words
will be. It depends on the width of the browser, which font is loaded and its
line height.</p><p>We could change the DOM and move the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> into the text element but again,
that would mean the content’s out of order. We’d end up with a horrible jumble:</p><div><pre class="prism-code language-html"><code class="prism-code language-html"><span class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain">In this paragraph, I want to comment on</span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">em</span><span class="token tag punctuation">&gt;</span><span class="token plain">these words</span><span class="token tag punctuation">&lt;/</span><span class="token tag">em</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">aside</span><span class="token tag punctuation">&gt;</span><span class="token plain">Does red clash with the theme?</span><span class="token tag punctuation">&lt;/</span><span class="token tag">aside</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">which are in the middle of the paragraph.</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span></span></code></pre></div><p>It’s also not good practice to do this. React gives us a warning:</p><blockquote><p>validateDOMNesting(...): <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;aside&gt;</span></span></code> cannot appear as a descendant of <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;p&gt;</span></span></code>.</p></blockquote><p>The <span>fundamental</span> problem is there’s no way in CSS to position elements relative
to arbitrary things. It would be neat if we could do something like this, but
we can’t:</p><aside class="styles-aside_161L"><p>Relative positioning looks at ancestors, not siblings.</p></aside><span></span><div><pre class="prism-code language-css"><code class="prism-code language-css"><span class="token-line"><span class="token selector">aside</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token property">position</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token function">element</span><span class="token punctuation">(</span><span class="token plain">#thing</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token property">top</span><span class="token punctuation">:</span><span class="token plain"> </span><span class="token number">0</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></span></code></pre></div><aside class="styles-aside_161L"><p>This hypothetical syntax is based on <a href="https://discourse.wicg.io/t/position-an-element-relatively-to-another-element-from-anywhere-in-the-dom/968" target="_blank">this blog
post</a>
on the same topic.</p></aside><p>I spent a while thinking of other ways to do this in CSS. Flexbox’s <code class="prism-code language-none"><span class="token-line"><span class="token plain">order</span></span></code>
property is interesting because it allows for a difference in how the DOM is
structured to how elements are presented. Ultimately, I couldn’t find a way and
resorted to <span>JavaScript</span>.</p><aside class="styles-aside_161L"><p>Disappointing, I know. If you can think of a way, please
<a href="https://twitter.com/chrispatuzzo" target="_blank">get in touch</a>!</p></aside><a href="#react"><h2 id="react" class="styles-h2_13mz">React</h2></a><p>In React, I created an <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;Aside&gt;</span></span></code> component that positions itself relative to
a target element. It encapsulates the behavior of figuring our what its
position should be and listens to events that might invalidate that, such as
resizing the window.</p><p>Here’s a first version:</p><span></span><span></span><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-javascript"><code class="prism-code language-javascript"><span class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">Aside</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> target</span><span class="token parameter punctuation">,</span><span class="token parameter"> children </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">style</span><span class="token punctuation">,</span><span class="token plain"> setStyle</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword null nil">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">align</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> rectangle </span><span class="token operator">=</span><span class="token plain"> target</span><span class="token punctuation">.</span><span class="token property-access">current</span><span class="token punctuation">.</span><span class="token method function property-access">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> offset </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> rectangle</span><span class="token punctuation">.</span><span class="token property-access">top</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> top</span><span class="token punctuation">:</span><span class="token plain"> offset </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token function">align</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"> </span><span class="token comment">// Align when the component is mounted.</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> listener </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span><span class="token plain"> align</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;resize&quot;</span><span class="token punctuation">,</span><span class="token plain"> listener</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token plain">aside className</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">css</span><span class="token punctuation">.</span><span class="token property-access">aside</span><span class="token punctuation">}</span><span class="token plain"> style</span><span class="token operator">=</span><span class="token punctuation">{</span><span class="token plain">style</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain">children</span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token operator">&lt;</span><span class="token operator">/</span><span class="token plain">aside</span><span class="token operator">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token keyword module">export</span><span class="token plain"> </span><span class="token keyword module">default</span><span class="token plain"> </span><span class="token maybe-class-name">Aside</span><span class="token punctuation">;</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>A React component that aligns itself with a target</p></span></figcaption></figure><p>There are really two main parts to it:</p><div class="more_space"><ol><li>The <code class="prism-code language-none"><span class="token-line"><span class="token plain">align</span></span></code> function calculates the y-coordinate of the <code class="prism-code language-none"><span class="token-line"><span class="token plain">target</span></span></code> which is a
<a href="https://reactjs.org/docs/refs-and-the-dom.html" target="_blank">reference</a> to a DOM
element. It sets the <code class="prism-code language-none"><span class="token-line"><span class="token plain">top</span></span></code> style property to this.</li><li>The <code class="prism-code language-none"><span class="token-line"><span class="token plain">useEffect</span></span></code> hook aligns the component when it’s first mounted and binds
a listener to re-align the component if the browser is resized.</li></ol></div><aside class="styles-aside_161L"><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect" target="_blank">getBoundingClientRect</a>
is <a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank">well-supported</a>
in modern browsers. It’s better than <code class="prism-code language-none"><span class="token-line"><span class="token plain">offsetTop</span></span></code> because it factors in CSS transformations.</p></aside><aside class="styles-aside_161L"><p>The function returned from
<a href="https://reactjs.org/docs/hooks-effect.html" target="_blank"><code class="prism-code language-none"><span class="token-line"><span class="token plain">useEffect</span></span></code></a> is called when the
component is unmounted. It’s used to
<a href="https://reactjs.org/docs/hooks-effect.html#effects-with-cleanup" target="_blank">clean up</a>
and remove the listener.</p></aside><p>Here’s how it looks for a real example. Notice the comments move around
in the sidebar, repositioning themselves next to their target content.</p><span></span><figure class="more_space styles-figure_23Vi"><a href="/videos/commentary-realignment.mp4" target="_blank"><video muted="" autoplay="" playsinline="" loop=""><source src="/videos/commentary-realignment.mp4" type="video/mp4"/></video></a><figcaption><span class="styles-arrow_2C7-">▲</span><span>Re-aligning comments while resizing the browser</span></figcaption></figure><aside class="styles-aside_161L"><p>This is taken from my recent article on <a href="/blog/palindromic-superpermutations">palindromic superpermutations</a>.</p></aside><p>To use the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;Aside&gt;</span></span></code> component, I create a ref to the target content then pass
that in:</p><span></span><span></span><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-jsx"><code class="prism-code language-jsx"><span class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token maybe-class-name">In</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token plain"> paragraph</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token constant">I</span><span class="token plain"> want to comment on</span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag">em</span><span class="token tag"> </span><span class="token tag attr-name">ref</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r</span><span class="token tag script language-javascript operator">=</span><span class="token tag script language-javascript function">createRef</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  these words</span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag">em</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">which are </span><span class="token keyword">in</span><span class="token plain"> the middle </span><span class="token keyword">of</span><span class="token plain"> the paragraph</span><span class="token punctuation">.</span><span class="token tag punctuation">&lt;/</span><span class="token tag">p</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Aside</span><span class="token tag"> </span><span class="token tag attr-name">target</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">Does</span><span class="token plain"> red clash </span><span class="token keyword">with</span><span class="token plain"> the theme</span><span class="token operator">?</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">Aside</span><span class="token tag punctuation">&gt;</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>How to use the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;Aside&gt;</span></span></code> component</p></span></figcaption></figure><aside class="styles-aside_161L"><p>I’ve already <code class="prism-code language-none"><span class="token-line"><span class="token plain">let r</span></span></code> by this point. This is re-assigned to
<a href="https://reactjs.org/docs/refs-and-the-dom.html#creating-refs" target="_blank"><code class="prism-code language-none"><span class="token-line"><span class="token plain">createRef()</span></span></code></a>
for each new reference.</p></aside><aside class="styles-aside_161L"><p><code class="prism-code language-none"><span class="token-line"><span class="token plain">r</span></span></code> is passed as the target.</p></aside><a href="#breaking-the-fourth-wall"><h3 id="breaking-the-fourth-wall" class="styles-h3_yb8_">Breaking the fourth wall</h3></a><p>As I write this article, I’m using this component a lot!
Let’s peek at <span>the code</span>:</p><aside class="styles-aside_161L">Well this is unexpected. </aside><span></span><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-jsx"><code class="prism-code language-jsx"><span class="token-line"><span class="token plain">### </span><span class="token maybe-class-name">Breaking</span><span class="token plain"> the fourth wall</span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token maybe-class-name">As</span><span class="token plain"> </span><span class="token constant">I</span><span class="token plain"> write </span><span class="token keyword">this</span><span class="token plain"> article</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token constant">I</span><span class="token plain">’m using </span><span class="token keyword">this</span><span class="token plain"> component a lot</span><span class="token operator">!</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Let’s</span><span class="token plain"> peek at </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">ref</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r</span><span class="token tag script language-javascript operator">=</span><span class="token tag script language-javascript function">createRef</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain">the code</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">:</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Aside</span><span class="token tag"> </span><span class="token tag attr-name">target</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token maybe-class-name">Well</span><span class="token plain"> </span><span class="token keyword">this</span><span class="token plain"> is unexpected</span><span class="token punctuation">.</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token comment">/* Waves to self. 👋 */</span><span class="token punctuation">}</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">Aside</span><span class="token tag punctuation">&gt;</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>Using the <code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;Aside&gt;</span></span></code> component in <strong>this</strong> article</p></span></figcaption></figure><aside class="styles-aside_161L"><p>I’m using a hybrid of Markdown that supports JSX. It’s called
<a href="https://github.com/mdx-js/mdx" target="_blank">MDX</a>.</p></aside><p>If your browser is wide enough, you <em>should</em> see ‘Well this is unexpected’ on
the right-hand side of ‘the code’. Otherwise, it’ll appear in the main flow.</p><p>In some cases, there’s no word or phrase in the DOM to refer to. This is the
case with images, videos and code blocks that use the <a href="https://www.w3schools.com/tags/tag_pre.asp" target="_blank"><code class="prism-code language-none"><span class="token-line"><span class="token plain">&lt;pre&gt;</span></span></code>
tag</a>. <span>For</span> these cases, I built an <em>escape hatch</em> that lets me
move comments down by a fixed amount:</p><span></span><aside class="styles-aside_161L">This aside is moved down 70 pixels.</aside><div><pre class="prism-code language-jsx"><code class="prism-code language-jsx"><span class="token-line"><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">ref</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r </span><span class="token tag script language-javascript operator">=</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">createRef</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;</span><span class="token tag class-name">Aside</span><span class="token tag"> </span><span class="token tag attr-name">target</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">r</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">moveDown</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript number">70</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token maybe-class-name">This</span><span class="token plain"> aside is moved down </span><span class="token number">70</span><span class="token plain"> pixels</span><span class="token punctuation">.</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token tag punctuation">&lt;/</span><span class="token tag class-name">Aside</span><span class="token tag punctuation">&gt;</span></span></code></pre></div><aside class="styles-aside_161L"><p>These elements tend to have a fixed height, anyway.</p></aside><p>This amount is then added to the <code class="prism-code language-none"><span class="token-line"><span class="token plain">offset</span></span></code>:</p><figure class="undefined styles-figure_23Vi"><div><pre class="prism-code language-javascript"><code class="prism-code language-javascript"><span class="token-line"><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name">Aside</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter punctuation">{</span><span class="token parameter"> target</span><span class="token parameter punctuation">,</span><span class="token parameter"> children</span><span class="token parameter punctuation">,</span><span class="token parameter"> moveDown </span><span class="token parameter operator">=</span><span class="token parameter"> </span><span class="token parameter number">0</span><span class="token parameter"> </span><span class="token parameter punctuation">}</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token function-variable function">align</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token arrow operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> offset </span><span class="token operator">=</span><span class="token plain"> </span><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token property-access">scrollY</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> rectangle</span><span class="token punctuation">.</span><span class="token property-access">top</span><span class="token plain"> </span><span class="token operator">+</span><span class="token plain"> moveDown</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">    </span><span class="token function">setStyle</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> top</span><span class="token punctuation">:</span><span class="token plain"> offset </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span></span><span class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></span><span class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre></div><figcaption><span class="styles-arrow_2C7-">▲</span><span><p>Moving comments down by a fixed amount</p></span></figcaption></figure><p>All <span>told</span>, this serves very well as a means of commenting on variety of things:
text, images, code and (as we’ve seen) even comments themselves!</p><aside class="styles-aside_161L"><p>Or comments about<span style="opacity:0.8"> comments</span><span style="opacity:0.7"> about</span><span style="opacity:0.6"> comments</span><span style="opacity:0.5"> about</span><span style="opacity:0.4"> comments</span><span style="opacity:0.3"> about</span><span style="opacity:0.2"> comments</span><span style="opacity:0.1"> about</span><span style="opacity:0"> secrets</span></p></aside><a href="#incremental-improvements"><h3 id="incremental-improvements" class="styles-h3_yb8_">Incremental improvements</h3></a><p>In part two of this article we’ll be refine our component in a number of ways:</p><ul><li>We’ll cope with slow-loading images and fonts</li><li>We’ll handle a race condition with React refs</li><li>We’ll add debouncing, for a smoother browser experience</li><li>We’ll extract code into hooks to make things tidy</li><li>We’ll stare into the face of evil, aka. print layouts</li></ul><p>Sounds exciting!? I think so... See you in <a href="/blog/react-commentary-sidebar-2">part two</a>.</p><div class="styles-nav_bar_2D66"><span class="styles-breadcrumbs_2-AT"><a href="/blog/pair-programming-in-sentient">tuzz.tech</a><a href="/blog/pair-programming-in-sentient">blog</a></span><span class="styles-links_nqg2"><a href="/blog/palindromic-superpermutations">← Previous</a><a href="/blog/react-commentary-sidebar-2">Next Article →</a></span></div></div></div></div></div><div class="styles-footer_1oSO"><p>© <!-- -->2020<!-- --> <!-- --> <a href="https://twitter.com/chrispatuzzo" target="_blank">Chris Patuzzo</a></p></div></div></div><script type="text/javascript">window.__routeInfo = JSON.parse("{\"template\":\"__react_static_root__/app/pages/blog/react-commentary-sidebar.mdx\",\"sharedHashesByProp\":{},\"data\":{},\"path\":\"blog/react-commentary-sidebar\",\"sharedData\":{},\"siteData\":{}}");</script><script defer="" type="text/javascript" src="/templates/__react_static_root__/app/pages/blog/adding-bash-completion.mdx~__react_static_root__/app/pages/blog~1caefab3.c0ff43d2.js"></script><script defer="" type="text/javascript" src="/templates/__react_static_root__/app/pages/blog/react-commentary-sidebar.mdx.8a5c992c.js"></script><script defer="" type="text/javascript" src="/templates/styles.f5f0f4b2.js"></script><script defer="" type="text/javascript" src="/templates/vendors~main.abecbdad.js"></script><script defer="" type="text/javascript" src="/main.4c9105b0.js"></script></body></html>